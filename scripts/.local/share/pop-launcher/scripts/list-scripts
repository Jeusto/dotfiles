#!/usr/bin/bash
#
# name: Scripts & commands
# keywords: scripts audio screenshot sh script list rofi pactl playerctl gnome screenshot commands emoji
# icon: utilities-terminal-symbolic 

screenshotsDir="$HOME/Pictures/screenshots"
scripts_path="$HOME/.local/share/pop-launcher/scripts/"

declare -A commands=(
    ["ğŸ’¡ Yeelight: Toggle lights"]="/home/asaday/.cargo/bin/yeelight-cli 192.168.1.20 toggle"
    ["ğŸ”‡ Audio: Mute/unmute"]="pactl set-sink-mute @DEFAULT_SINK@ toggle"
    ["ğŸ”Š Audio: Set volume"]="volume"
    ["â¯ï¸  Audio: Play/pause"]="playerctl play-pause"
    ["â®ï¸  Audio: Previous"]="playerctl previous"
    ["â­ï¸  Audio: Next"]="playerctl next"
    ["ğŸ’¾ Screenshot: Full screen"]="gnome-screenshot"
    ["ğŸ’¾ Screenshot: Select area"]="gnome-screenshot -a"
    ["ğŸ’¾ Screenshot: Current window"]="gnome-screenshot --window"
    ["ğŸ’¾ Screenshot: Open last screenshot"]="xdg-open $screenshotsDir/'$(ls -t $screenshotsDir | head -1)'"
    ["ğŸ’¾ Screenshot: Show folder"]="xdg-open $screenshotsDir"
)

show_commands_menu() {
    prompt="commands:"
    readarray -t scripts_array < <(find "$scripts_path"/* -maxdepth 1 -type f -executable \
                                  -exec grep -Iq . {} \; -print | sed 's|^'"$scripts_path"'/|ğŸ“œ |' | sort)

    selected=$(printf '%s\n' "${!commands[@]}" "${scripts_array[@]}" | rofi -dmenu -i -p "$prompt")

    if [ -n "$selected" ]; then
        if [[ "$selected" == ğŸ“œ* ]]; then
            # Script option selected
            eval "$scripts_path/${selected#ğŸ“œ }"
        else
            # Other commands selected
            case "$selected" in
                "ğŸ”Š Audio: Set volume")
                    volume=$(rofi -dmenu -i -p "Enter volume level (0-100):")
                    if [[ "$volume" =~ ^[0-9]+$ && $volume -ge 0 && $volume -le 100 ]]; then
                        pactl set-sink-volume @DEFAULT_SINK@ "$volume"%
                    else
                        notify-send "Invalid volume level!"
                    fi
                    ;;
                *)
                    eval "${commands[$selected]}"
                    ;;
            esac
        fi
    fi
}

show_commands_menu

exit 0

